import time, socket, datetime, os, fcntl, struct, sqlite3#import time, IP, time and date <br> from flask import Flask, render_template, request, jsonify, request, send_file #import web app <br> from w1thermsensor import W1ThermSensor <br> import netifaces as ni <br> #from weather import Weather, Unit <br>  <br> #weather = Weather(unit=Unit.CELSIUS) <br> #lookup = weather.lookup(560743) <br>  <br> global int_time <br> int_time = datetime.datetime.now() <br>  <br> app = Flask(__name__) #Assigns app <br>  <br> #os.system("sudo mount -t exfat /dev/sda1 /media/usb") <br>  <br> localtime = time.asctime( time.localtime(time.time()) ) #Gets the time <br> print (" * Current time :" + str(localtime)) #Displays Time <br>  <br> ni.ifaddresses(\'eth0\') <br> IP = ni.ifaddresses(\'eth0\')[ni.AF_INET][0][\'addr\'] <br>  <br> def accessed(): <br> F = open("A.txt", "r") <br> A = F.read() <br> F.close() <br> F = open("A.txt", "w") <br> F.write(str(int(A)+1)) <br> F.close() <br>  <br>  <br> def getTemperature(): <br> sensor = W1ThermSensor() <br> temperature = sensor.get_temperature() <br> #temperature = 125.29 <br> return(temperature) <br>  <br> def makeWebpage(): <br> #weather = Weather(unit=Unit.CELSIUS) <br> #lookup = weather.lookup(17044) <br> #wind = lookup.wind <br> W = open("templates/index.html", "w") <br> F = open("First.txt", "r") <br> M = open("Middle.txt", "r") <br> L = open("Last.txt", "r") <br> T = getTemperature() <br> if  T >= 30: <br> B = "Hot.png" <br> elif 18 <= T < 30: <br> B = "Warm.png" <br> elif 5 < T < 18: <br> B = "Cold.png" <br> elif 0 < T <= 5: <br> B = "rCold.png" <br> else: <br> B = "sCold.png" <br> W.write(F.read() + B + M.read() + str(round(T, 1)) + "\xc2\xb0C <h4> " +  str(round(T, 2)) + "\xc2\xb0C </h4> " + L.read()) <br> accessed() <br> W.close() <br> F.close() <br> M.close() <br> L.close() <br>  <br> @app.route(\'/\') #Sets index <br> def index(): <br> makeWebpage() <br> return render_template(\'index.html\') #Displays HTML page \'Relay.html\' <br>  <br> @app.route(\'/about\') #Sets index <br> def about(): <br> Af = open("aF.txt", "r") <br> Al = open("aL.txt", "r") <br> Aw = open("templates/about.html", "w") <br> N = open("A.txt", "r") <br> Uptime = datetime.datetime.now() - int_time <br> Aw.write(Af.read() + "<p> <center> This Weather Station Has Been Used " + str(N.read()) + " Times </center> </p> <p> <center> Temperature (Up to 3dp): " + str(getTemperature()) + "\xc2\xb0C </center> </p> <center> <p> Uptime: " + str(Uptime.days)+ " day(s), " + str(Uptime.seconds//3600) + " hour(s), "+ str(int((Uptime.seconds//60)%60)) + " minute(s) and " + str(int(Uptime.seconds%60)) + " second(s) </center>" + Al.read()) <br> Af.close() <br> Al.close() <br> Aw.close() <br> N.close() <br> return render_template(\'about.html\') #Displays HTML page \'Relay.html\' <br>  <br> @app.route(\'/source\') #Sets index <br> def source(): <br> return send_file(\'Weather.py\') <br>  <br> if __name__ == \'__main__\': <br> app.run(debug=True, host=(str(IP)), threaded=True, port=80) <br> GPIO.cleanup()\